  select CR.*,HM.NEXT_STATUS,CR.NEXT_USER_ID,
 case when NEXT_STATUS!='Closed' then DATEDIFF(day,STATUS_DATE,getdate()) else null
 end as PendingDays,DATEDIFF(day,CR.CREATED_ON, GETDATE()) as Created_vs_Current 

 from App_COMPLAINT_HELP_REGISTER CR left join App_HELPDESK_STATUS_MASTER HM on CR.COMPLAINT_STATUS = HM.STATUS_CODE 

OUTER APPLY
(
    SELECT TOP 1 D.*, FL.USERNAME FROM App_COMPLAINT_HELP_DETAILS D INNER JOIN App_HELPDESK_FWD_LIST FL 
        ON D.NEXT_USER_ID = FL.USERID
    WHERE D.MasterID = CR.ID  
    ORDER BY D.CREATED_ON DESC  
) FD



 where 1=1 and STATUS_CODE= 'S0007' order by COMPLAINT_DATE desc
